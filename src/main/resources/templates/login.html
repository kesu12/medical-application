<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Вход - Медицинское приложение</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #0b1020; color: #e7ecf5; }
        .wrap { display: grid; place-items: center; min-height: 100vh; padding: 24px; }
        .card { width: 100%; max-width: 420px; background: #121a33; border: 1px solid #1f2a4a; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.35); padding: 24px; }
        .title { margin: 0 0 8px; font-size: 22px; font-weight: 600; }
        .muted { color: #a7b1c6; margin: 0 0 16px; }
        .field { display: grid; gap: 6px; margin-bottom: 12px; }
        .input { background: #0e1630; border: 1px solid #1f2a4a; color: #e7ecf5; padding: 10px 12px; border-radius: 8px; outline: none; }
        .input:focus { border-color: #2c6bed; }
        .btn { width: 100%; appearance: none; border: 1px solid #2b3a63; background: #2c6bed; color: #fff; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .btn:hover { background: #1f57c9; }
        .hint { font-size: 12px; color: #93a2bf; margin-top: 10px; }
    </style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1 class="title">Вход в систему</h1>
    <p class="muted">Это не выполняет Spring Security form login; он вызывает JSON auth API и сохраняет JWT токен.</p>
    <form id="loginForm">
      <div class="field">
        <label for="username">Имя пользователя</label>
        <input class="input" id="username" name="username" required>
      </div>
      <div class="field">
        <label for="password">Пароль</label>
        <input class="input" id="password" type="password" name="password" required>
      </div>
      <button class="btn" type="submit">Войти</button>
    </form>
    <div style="margin-top: 16px; text-align: center;">
      <a href="/register" class="btn" style="background: #1a2444; text-decoration: none; display: inline-block; width: auto; padding: 8px 16px;">Регистрация</a>
    </div>
    <div class="hint">Токен будет сохранен в localStorage как <code>jwt</code>.</div>
  </div>
</div>

<script>
  const form = document.getElementById('loginForm');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    try {
      const res = await fetch('/api/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      });
      const data = await res.json().catch(() => null);
      if (!res.ok) {
        const message = data && data.message ? data.message : 'Ошибка входа';
        throw new Error(message);
      }
      if (data && data.accessToken) {
        if (window.AppApi && AppApi.setTokens) {
          AppApi.setTokens({ accessToken: data.accessToken, refreshToken: data.refreshToken, tokenType: data.tokenType });
        } else {
          localStorage.setItem('accessToken', data.accessToken);
          if (data.refreshToken) localStorage.setItem('refreshToken', data.refreshToken);
          if (data.tokenType) localStorage.setItem('tokenType', data.tokenType);
        }
    window.location.href = '/dashboard';
      } else {
        alert('Неожиданный ответ');
      }
    } catch (err) {
      alert(err.message || 'Ошибка входа');
    }
  });
</script>
</body>
</html>


