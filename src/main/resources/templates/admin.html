<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Админ панель - Медицинское приложение</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #0b1020; color: #e7ecf5; }
    .topbar { display:flex; align-items:center; justify-content:space-between; padding:14px 20px; background:#121a33; border-bottom:1px solid #1f2a4a; }
    .container { padding: 20px; max-width: 1100px; margin: 0 auto; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .card { background:#121a33; border:1px solid #1f2a4a; border-radius:12px; padding:16px; }
    .btn { appearance:none; border:1px solid #2b3a63; background:#1a2444; color:#e7ecf5; padding:8px 12px; border-radius:8px; cursor:pointer; font-weight:600; }
    .btn.primary { background:#2c6bed; border-color:#2c6bed; }
    .list { display:grid; gap:6px; max-height: 360px; overflow:auto; }
    .row { display:flex; gap:8px; align-items:center; justify-content:space-between; padding:8px; border:1px solid #1f2a4a; border-radius:8px; }
    .muted { color:#9aacc8; }
    input, select { background:#0e1630; border:1px solid #1f2a4a; color:#e7ecf5; padding:8px 10px; border-radius:8px; }
    .fields { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
  </style>
</head>
<body>
<div class="topbar">
  <div>Админ панель</div>
  <div>
    <a class="btn" href="/">Главная</a>
    <a class="btn" href="/register">Регистрация</a>
    <a class="btn" href="/dashboard">Панель управления</a>
    <a class="btn" href="/assignment-admin">Управление назначениями</a>
    <button class="btn" id="logoutBtn">Выйти</button>
  </div>
  </div>
<div class="container">
  <div class="grid">
    <div class="card">
      <h3>Пользователи</h3>
      <div class="fields">
        <input id="userId" placeholder="ID пользователя" style="width:120px;">
        <select id="role">
          <option>DEFAULT</option>
          <option>DOCTOR</option>
          <option>NURSE</option>
        </select>
        <button class="btn" id="btnRole">Установить роль</button>
        <button class="btn" id="btnActivate">Активировать</button>
        <button class="btn" id="btnDeactivate">Деактивировать</button>
        <button class="btn" id="btnDelete">Удалить</button>
      </div>
      <div class="fields">
        <button class="btn primary" id="btnListUnconfirmed">Список неподтвержденных</button>
        <button class="btn primary" id="btnListDefault">Загрузить всех DEFAULT пользователей</button>
      </div>
      <pre id="usersOut" class="muted">Результат...</pre>
    </div>

    <div class="card">
      <h3>Отделы</h3>
      <div class="fields">
        <input id="depId" placeholder="ID" style="width:120px;">
        <input id="depName" placeholder="Название">
        <input id="depDesc" placeholder="Описание">
      </div>
      <div class="fields">
        <button class="btn primary" id="btnDepCreate">Создать</button>
        <button class="btn" id="btnDepUpdate">Обновить</button>
        <button class="btn" id="btnDepDelete">Удалить</button>
      </div>
      <div class="fields">
        <button class="btn" id="btnDepList">Список всех</button>
      </div>
      <pre id="depsOut" class="muted">Результат...</pre>
    </div>
  </div>

  <div class="grid" style="margin-top: 20px;">
    <div class="card">
      <h3>Назначение врача в отдел</h3>
      <div class="fields">
        <input id="doctorId" placeholder="ID врача" style="width:120px;">
        <input id="departmentId" placeholder="ID отдела" style="width:120px;">
        <button class="btn primary" id="btnAssignDepartment">Назначить отдел</button>
      </div>
      <div class="fields">
        <button class="btn" id="btnListDoctors">Список всех врачей</button>
        <button class="btn" id="btnListDepartments">Список всех отделов</button>
      </div>
      <pre id="assignmentOut" class="muted">Результат...</pre>
    </div>

    <div class="card">
      <h3>Управление пользователями</h3>
      <div class="fields">
        <button class="btn" id="btnListAllUsers">Список всех пользователей</button>
        <button class="btn" id="btnListConfirmed">Список подтвержденных пользователей</button>
      </div>
      <div class="fields">
        <button class="btn" id="btnListByRole">Список по роли</button>
        <select id="roleFilter">
          <option value="DOCTOR">DOCTOR</option>
          <option value="NURSE">NURSE</option>
          <option value="PATIENT">PATIENT</option>
          <option value="DEFAULT">DEFAULT</option>
        </select>
      </div>
      <pre id="userManagementOut" class="muted">Результат...</pre>
    </div>
  </div>
</div>

<script src="/js/api.js"></script>
<script>
  function show(obj){ return JSON.stringify(obj, null, 2); }
  if (!AppApi.isLoggedIn()) location.href = '/signin';

  document.getElementById('logoutBtn').onclick = async () => { await AppApi.logout(); location.href = '/signin'; };

  // Users
  document.getElementById('btnListUnconfirmed').onclick = async () => {
    const res = await AppApi.apiGet('/api/admin/users/unconfirmed');
    document.getElementById('usersOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };
  document.getElementById('btnListDefault').onclick = async () => {
    const res = await AppApi.apiGet('/api/admin/users/by-role/DEFAULT');
    document.getElementById('usersOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };
  document.getElementById('btnRole').onclick = async () => {
    const id = document.getElementById('userId').value; const role = document.getElementById('role').value;
    const res = await AppApi.apiPatch(`/api/admin/users/${id}/role/${role}`);
    document.getElementById('usersOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };
  document.getElementById('btnActivate').onclick = async () => {
    const id = document.getElementById('userId').value;
    const res = await AppApi.apiPatch(`/api/admin/users/${id}/activate`);
    document.getElementById('usersOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };
  document.getElementById('btnDeactivate').onclick = async () => {
    const id = document.getElementById('userId').value;
    const res = await AppApi.apiPatch(`/api/admin/users/${id}/deactivate`);
    document.getElementById('usersOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };
  document.getElementById('btnDelete').onclick = async () => {
    const id = document.getElementById('userId').value;
    if (!confirm('Вы уверены, что хотите удалить пользователя #' + id + '?')) return;
    const res = await AppApi.apiDelete(`/api/admin/users/${id}`);
    document.getElementById('usersOut').textContent = res.ok ? 'Удалено' : 'Ошибка: ' + res.status;
  };

  // Departments
  document.getElementById('btnDepCreate').onclick = async () => {
    const name = document.getElementById('depName').value; const description = document.getElementById('depDesc').value || null;
    const res = await AppApi.apiPost('/api/admin/department/add', { name, description });
    document.getElementById('depsOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };
  document.getElementById('btnDepUpdate').onclick = async () => {
    const id = document.getElementById('depId').value; const name = document.getElementById('depName').value || null; const description = document.getElementById('depDesc').value || null;
    const res = await AppApi.apiPatch(`/api/admin/department/${id}`, { name, description });
    document.getElementById('depsOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };
  document.getElementById('btnDepDelete').onclick = async () => {
    const id = document.getElementById('depId').value;
    if (!confirm('Подтвердите удаление отдела #' + id + '?')) return;
    const res = await AppApi.apiDelete(`/api/admin/department/${id}`);
    document.getElementById('depsOut').textContent = res.ok ? 'Удалено' : 'Ошибка: ' + res.status;
  };
  document.getElementById('btnDepList').onclick = async () => {
    const res = await AppApi.apiGet('/api/admin/department/all');
    document.getElementById('depsOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };

  // Doctor Department Assignment
  document.getElementById('btnAssignDepartment').onclick = async () => {
    const doctorId = document.getElementById('doctorId').value;
    const departmentId = document.getElementById('departmentId').value;
    
    if (!doctorId || !departmentId) {
      document.getElementById('assignmentOut').textContent = 'Пожалуйста, введите ID врача и ID отдела';
      return;
    }
    
    const res = await AppApi.apiPatch(`/api/admin/users/${doctorId}/assign-department`, { departmentId: parseInt(departmentId) });
    document.getElementById('assignmentOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };

  document.getElementById('btnListDoctors').onclick = async () => {
    const res = await AppApi.apiGet('/api/admin/users/by-role/DOCTOR');
    document.getElementById('assignmentOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };

  document.getElementById('btnListDepartments').onclick = async () => {
    const res = await AppApi.apiGet('/api/admin/department/all');
    document.getElementById('assignmentOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };

  // User Management
  document.getElementById('btnListAllUsers').onclick = async () => {
    const res = await AppApi.apiGet('/api/admin/users');
    document.getElementById('userManagementOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };

  document.getElementById('btnListConfirmed').onclick = async () => {
    const res = await AppApi.apiGet('/api/admin/users/confirmed');
    document.getElementById('userManagementOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };

  document.getElementById('btnListByRole').onclick = async () => {
    const role = document.getElementById('roleFilter').value;
    const res = await AppApi.apiGet(`/api/admin/users/by-role/${role}`);
    document.getElementById('userManagementOut').textContent = res.ok ? show(await res.json()) : 'Ошибка: ' + res.status;
  };
</script>
</body>
</html>


